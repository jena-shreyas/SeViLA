[I socket.cpp:576] [c10d] The server socket has started to listen on [::]:29500.
[I socket.cpp:849] [c10d] The client socket has connected to [localhost]:29500 on [localhost]:51486.
type 1
0
1
0
| distributed init (rank 0, world 1): env://
[I socket.cpp:849] [c10d] The client socket has connected to [localhost]:29500 on [localhost]:51498.
[I ProcessGroupNCCL.cpp:687] [Rank 0] ProcessGroupNCCL initialization options:NCCL_ASYNC_ERROR_HANDLING: 1, NCCL_DESYNC_DEBUG: 0, NCCL_ENABLE_TIMING: 0, NCCL_BLOCKING_WAIT: 0, TIMEOUT(ms): 31536000000, USE_HIGH_PRIORITY_STREAM: 0, TORCH_DISTRIBUTED_DEBUG: OFF, NCCL_DEBUG: INFO, ID=148626912
[I ProcessGroupNCCL.cpp:2787] Rank 0 using GPU 0 to perform barrier as devices used by this process are currently unknown. This can potentially cause a hang if this rank to GPU mapping is incorrect.Specify device_ids in barrier() to force use of a particular device.
gpu:500249:500249 [0] NCCL INFO Bootstrap : Using eno8303:10.5.30.82<0>
gpu:500249:500249 [0] NCCL INFO NET/Plugin : Plugin load (libnccl-net.so) returned 2 : libnccl-net.so: cannot open shared object file: No such file or directory
gpu:500249:500249 [0] NCCL INFO NET/Plugin : No plugin found, using internal implementation
gpu:500249:500249 [0] NCCL INFO cudaDriverVersion 12020
NCCL version 2.18.1+cuda12.1
gpu:500249:500295 [0] NCCL INFO Failed to open libibverbs.so[.1]
gpu:500249:500295 [0] NCCL INFO NET/Socket : Using [0]eno8303:10.5.30.82<0>
gpu:500249:500295 [0] NCCL INFO Using network Socket
gpu:500249:500295 [0] NCCL INFO Setting affinity for GPU 0 to aaaaaaaa
gpu:500249:500295 [0] NCCL INFO Channel 00/32 :    0
gpu:500249:500295 [0] NCCL INFO Channel 01/32 :    0
gpu:500249:500295 [0] NCCL INFO Channel 02/32 :    0
gpu:500249:500295 [0] NCCL INFO Channel 03/32 :    0
gpu:500249:500295 [0] NCCL INFO Channel 04/32 :    0
gpu:500249:500295 [0] NCCL INFO Channel 05/32 :    0
gpu:500249:500295 [0] NCCL INFO Channel 06/32 :    0
gpu:500249:500295 [0] NCCL INFO Channel 07/32 :    0
gpu:500249:500295 [0] NCCL INFO Channel 08/32 :    0
gpu:500249:500295 [0] NCCL INFO Channel 09/32 :    0
gpu:500249:500295 [0] NCCL INFO Channel 10/32 :    0
gpu:500249:500295 [0] NCCL INFO Channel 11/32 :    0
gpu:500249:500295 [0] NCCL INFO Channel 12/32 :    0
gpu:500249:500295 [0] NCCL INFO Channel 13/32 :    0
gpu:500249:500295 [0] NCCL INFO Channel 14/32 :    0
gpu:500249:500295 [0] NCCL INFO Channel 15/32 :    0
gpu:500249:500295 [0] NCCL INFO Channel 16/32 :    0
gpu:500249:500295 [0] NCCL INFO Channel 17/32 :    0
gpu:500249:500295 [0] NCCL INFO Channel 18/32 :    0
gpu:500249:500295 [0] NCCL INFO Channel 19/32 :    0
gpu:500249:500295 [0] NCCL INFO Channel 20/32 :    0
gpu:500249:500295 [0] NCCL INFO Channel 21/32 :    0
gpu:500249:500295 [0] NCCL INFO Channel 22/32 :    0
gpu:500249:500295 [0] NCCL INFO Channel 23/32 :    0
gpu:500249:500295 [0] NCCL INFO Channel 24/32 :    0
gpu:500249:500295 [0] NCCL INFO Channel 25/32 :    0
gpu:500249:500295 [0] NCCL INFO Channel 26/32 :    0
gpu:500249:500295 [0] NCCL INFO Channel 27/32 :    0
gpu:500249:500295 [0] NCCL INFO Channel 28/32 :    0
gpu:500249:500295 [0] NCCL INFO Channel 29/32 :    0
gpu:500249:500295 [0] NCCL INFO Channel 30/32 :    0
gpu:500249:500295 [0] NCCL INFO Channel 31/32 :    0
gpu:500249:500295 [0] NCCL INFO Trees [0] -1/-1/-1->0->-1 [1] -1/-1/-1->0->-1 [2] -1/-1/-1->0->-1 [3] -1/-1/-1->0->-1 [4] -1/-1/-1->0->-1 [5] -1/-1/-1->0->-1 [6] -1/-1/-1->0->-1 [7] -1/-1/-1->0->-1 [8] -1/-1/-1->0->-1 [9] -1/-1/-1->0->-1 [10] -1/-1/-1->0->-1 [11] -1/-1/-1->0->-1 [12] -1/-1/-1->0->-1 [13] -1/-1/-1->0->-1 [14] -1/-1/-1->0->-1 [15] -1/-1/-1->0->-1 [16] -1/-1/-1->0->-1 [17] -1/-1/-1->0->-1 [18] -1/-1/-1->0->-1 [19] -1/-1/-1->0->-1 [20] -1/-1/-1->0->-1 [21] -1/-1/-1->0->-1 [22] -1/-1/-1->0->-1 [23] -1/-1/-1->0->-1 [24] -1/-1/-1->0->-1 [25] -1/-1/-1->0->-1 [26] -1/-1/-1->0->-1 [27] -1/-1/-1->0->-1 [28] -1/-1/-1->0->-1 [29] -1/-1/-1->0->-1 [30] -1/-1/-1->0->-1 [31] -1/-1/-1->0->-1
gpu:500249:500295 [0] NCCL INFO P2P Chunksize set to 131072
gpu:500249:500295 [0] NCCL INFO Connected all rings
gpu:500249:500295 [0] NCCL INFO Connected all trees
gpu:500249:500295 [0] NCCL INFO 32 coll channels, 0 nvls channels, 32 p2p channels, 32 p2p channels per peer
gpu:500249:500295 [0] NCCL INFO comm 0x9d0f500 rank 0 nranks 1 cudaDev 0 busId ca000 commId 0x7cb775600f12f8cb - Init COMPLETE
[I ProcessGroupNCCL.cpp:1342] NCCL_DEBUG: INFO
2024-01-07 17:06:25,230 [INFO] 
=====  Running Parameters    =====
2024-01-07 17:06:25,231 [INFO] {
    "accum_grad_iters": 8,
    "amp": true,
    "batch_size_eval": 2,
    "batch_size_train": 1,
    "device": "cuda",
    "dist_backend": "nccl",
    "dist_url": "env://",
    "distributed": true,
    "evaluate": false,
    "find_unused_parameters": true,
    "gpu": 0,
    "init_lr": 3e-05,
    "lr_sched": "linear_warmup_cosine_lr",
    "max_epoch": 10,
    "max_len": 30,
    "min_len": 8,
    "min_lr": 0,
    "num_beams": 5,
    "num_workers": 1,
    "output_dir": "expts/causalvidqa_ft/07_01_2024_17_06_20",
    "rank": 0,
    "resume_ckpt_path": null,
    "seed": 42,
    "task": "videoqa",
    "test_splits": [
        "test"
    ],
    "train_splits": [
        "train"
    ],
    "valid_splits": [
        "val"
    ],
    "warmup_lr": 1e-08,
    "warmup_steps": 1000,
    "weight_decay": 0.05,
    "world_size": 1
}
2024-01-07 17:06:25,231 [INFO] 
======  Dataset Attributes  ======
2024-01-07 17:06:25,231 [INFO] 
======== causalvidqa =======
2024-01-07 17:06:25,231 [INFO] {
    "build_info": {
        "annotations": {
            "test": {
                "storage": "/home/shreyasjena/BTP/SeViLA/data/annotations/test.json",
                "url": "/home/shreyasjena/BTP/SeViLA/data/annotations/test.json"
            },
            "train": {
                "storage": "/home/shreyasjena/BTP/SeViLA/data/annotations/train.json",
                "url": "/home/shreyasjena/BTP/SeViLA/data/annotations/train.json"
            },
            "val": {
                "storage": "/home/shreyasjena/BTP/SeViLA/data/annotations/val.json",
                "url": "/home/shreyasjena/BTP/SeViLA/data/annotations/val.json"
            }
        },
        "videos": {
            "storage": "/home/shreyasjena/BTP/SeViLA/data/videos"
        }
    },
    "data_type": "videos",
    "text_processor": {
        "eval": {
            "max_words": 50,
            "name": "blip_question"
        },
        "train": {
            "max_words": 50,
            "name": "blip_question"
        }
    },
    "vis_processor": {
        "eval": {
            "image_size": 224,
            "n_frms": 32,
            "name": "blip_video_eval"
        },
        "train": {
            "image_size": 224,
            "n_frms": 32,
            "name": "blip2_video_train"
        }
    }
}
2024-01-07 17:06:25,231 [INFO] 
======  Model Attributes  ======
2024-01-07 17:06:25,232 [INFO] {
    "answer_num": 5,
    "arch": "sevila",
    "drop_path_rate": 0,
    "finetuned": "sevila_checkpoints/sevila_pretrained.pth",
    "frame_num": 4,
    "freeze_vit": true,
    "image_size": 224,
    "load_finetuned": true,
    "model_type": "pretrain_flant5xl",
    "num_query_token": 32,
    "pretrained": "https://storage.googleapis.com/sfr-vision-language-research/LAVIS/models/BLIP2/blip2_pretrained_flant5xl.pth",
    "prompt": "",
    "t5_model": "google/flan-t5-xl",
    "task": "qvh_freeze_loc_train_qa_with_loc_train_qa_vid",
    "use_grad_checkpoint": true,
    "vit_precision": "fp16"
}
Dataset config :  {'data_type': 'videos', 'build_info': {'annotations': {'train': {'url': '/home/shreyasjena/BTP/SeViLA/data/annotations/train.json', 'storage': '/home/shreyasjena/BTP/SeViLA/data/annotations/train.json'}, 'val': {'url': '/home/shreyasjena/BTP/SeViLA/data/annotations/val.json', 'storage': '/home/shreyasjena/BTP/SeViLA/data/annotations/val.json'}, 'test': {'url': '/home/shreyasjena/BTP/SeViLA/data/annotations/test.json', 'storage': '/home/shreyasjena/BTP/SeViLA/data/annotations/test.json'}}, 'videos': {'storage': '/home/shreyasjena/BTP/SeViLA/data/videos'}}, 'vis_processor': {'train': {'name': 'blip2_video_train', 'n_frms': 32, 'image_size': 224}, 'eval': {'name': 'blip_video_eval', 'n_frms': 32, 'image_size': 224}}, 'text_processor': {'train': {'name': 'blip_question', 'max_words': 50}, 'eval': {'name': 'blip_question', 'max_words': 50}}}
Config keys :  dict_keys(['data_type', 'build_info', 'vis_processor', 'text_processor'])
Config : 

 {'data_type': 'videos', 'build_info': {'annotations': {'train': {'url': '/home/shreyasjena/BTP/SeViLA/data/annotations/train.json', 'storage': '/home/shreyasjena/BTP/SeViLA/data/annotations/train.json'}, 'val': {'url': '/home/shreyasjena/BTP/SeViLA/data/annotations/val.json', 'storage': '/home/shreyasjena/BTP/SeViLA/data/annotations/val.json'}, 'test': {'url': '/home/shreyasjena/BTP/SeViLA/data/annotations/test.json', 'storage': '/home/shreyasjena/BTP/SeViLA/data/annotations/test.json'}}, 'videos': {'storage': '/home/shreyasjena/BTP/SeViLA/data/videos'}}, 'vis_processor': {'train': {'name': 'blip2_video_train', 'n_frms': 32, 'image_size': 224}, 'eval': {'name': 'blip_video_eval', 'n_frms': 32, 'image_size': 224}}, 'text_processor': {'train': {'name': 'blip_question', 'max_words': 50}, 'eval': {'name': 'blip_question', 'max_words': 50}}}
Building datasets in base task ...
2024-01-07 17:06:25,232 [INFO] Using existing file /home/shreyasjena/BTP/SeViLA/data/annotations/train.json.
2024-01-07 17:06:25,232 [INFO] Using existing file /home/shreyasjena/BTP/SeViLA/data/annotations/val.json.
2024-01-07 17:06:25,232 [INFO] Using existing file /home/shreyasjena/BTP/SeViLA/data/annotations/test.json.
2024-01-07 17:06:25,233 [INFO] Building datasets...
Inside build processors ...
Config name :  blip2_video_train
Config name :  blip_video_eval
Config name :  blip_question
Config name :  blip_question
in build() fn, Processors built
[2024-01-07 17:06:28,255] torch.distributed.elastic.agent.server.api: [WARNING] Received Signals.SIGINT death signal, shutting down workers
[2024-01-07 17:06:28,255] torch.distributed.elastic.multiprocessing.api: [WARNING] Sending process 500249 closing signal SIGINT
Traceback (most recent call last):
  File "train.py", line 106, in <module>
    main()
  File "train.py", line 94, in main
    model = task.build_model(cfg)
  File "/home/shreyasjena/BTP/SeViLA/lavis/tasks/base_task.py", line 33, in build_model
    return model_cls.from_config(model_config)
  File "/home/shreyasjena/BTP/SeViLA/lavis/models/sevila_models/sevila.py", line 1022, in from_config
    model = cls(
  File "/home/shreyasjena/BTP/SeViLA/lavis/models/sevila_models/sevila.py", line 50, in __init__
    self.visual_encoder, self.ln_vision, self.ln_vision_loc = self.init_vision_encoder_sevila(
  File "/home/shreyasjena/BTP/SeViLA/lavis/models/blip2_models/blip2.py", line 78, in init_vision_encoder_sevila
    visual_encoder = create_eva_vit_g(
  File "/home/shreyasjena/BTP/SeViLA/lavis/models/eva_vit.py", line 416, in create_eva_vit_g
    model = VisionTransformer(
  File "/home/shreyasjena/BTP/SeViLA/lavis/models/eva_vit.py", line 278, in __init__
    self.blocks = nn.ModuleList([
  File "/home/shreyasjena/BTP/SeViLA/lavis/models/eva_vit.py", line 279, in <listcomp>
    Block(
  File "/home/shreyasjena/BTP/SeViLA/lavis/models/eva_vit.py", line 158, in __init__
    self.attn = Attention(
  File "/home/shreyasjena/BTP/SeViLA/lavis/models/eva_vit.py", line 76, in __init__
    self.qkv = nn.Linear(dim, all_head_dim * 3, bias=False)
  File "/home/shreyasjena/anaconda3/envs/sevila/lib/python3.8/site-packages/torch/nn/modules/linear.py", line 101, in __init__
    self.reset_parameters()
  File "/home/shreyasjena/anaconda3/envs/sevila/lib/python3.8/site-packages/torch/nn/modules/linear.py", line 107, in reset_parameters
    init.kaiming_uniform_(self.weight, a=math.sqrt(5))
  File "/home/shreyasjena/anaconda3/envs/sevila/lib/python3.8/site-packages/torch/nn/init.py", line 419, in kaiming_uniform_
    return tensor.uniform_(-bound, bound)
KeyboardInterrupt
Traceback (most recent call last):
  File "/home/shreyasjena/anaconda3/envs/sevila/lib/python3.8/runpy.py", line 194, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/home/shreyasjena/anaconda3/envs/sevila/lib/python3.8/runpy.py", line 87, in _run_code
    exec(code, run_globals)
  File "/home/shreyasjena/anaconda3/envs/sevila/lib/python3.8/site-packages/torch/distributed/run.py", line 810, in <module>
    main()
  File "/home/shreyasjena/anaconda3/envs/sevila/lib/python3.8/site-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 346, in wrapper
    return f(*args, **kwargs)
  File "/home/shreyasjena/anaconda3/envs/sevila/lib/python3.8/site-packages/torch/distributed/run.py", line 806, in main
    run(args)
  File "/home/shreyasjena/anaconda3/envs/sevila/lib/python3.8/site-packages/torch/distributed/run.py", line 797, in run
    elastic_launch(
  File "/home/shreyasjena/anaconda3/envs/sevila/lib/python3.8/site-packages/torch/distributed/launcher/api.py", line 134, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/home/shreyasjena/anaconda3/envs/sevila/lib/python3.8/site-packages/torch/distributed/launcher/api.py", line 255, in launch_agent
    result = agent.run()
  File "/home/shreyasjena/anaconda3/envs/sevila/lib/python3.8/site-packages/torch/distributed/elastic/metrics/api.py", line 124, in wrapper
    result = f(*args, **kwargs)
  File "/home/shreyasjena/anaconda3/envs/sevila/lib/python3.8/site-packages/torch/distributed/elastic/agent/server/api.py", line 736, in run
    result = self._invoke_run(role)
  File "/home/shreyasjena/anaconda3/envs/sevila/lib/python3.8/site-packages/torch/distributed/elastic/agent/server/api.py", line 877, in _invoke_run
    time.sleep(monitor_interval)
  File "/home/shreyasjena/anaconda3/envs/sevila/lib/python3.8/site-packages/torch/distributed/elastic/multiprocessing/api.py", line 62, in _terminate_process_handler
    raise SignalException(f"Process {os.getpid()} got signal: {sigval}", sigval=sigval)
torch.distributed.elastic.multiprocessing.api.SignalException: Process 500195 got signal: 2
